<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservar</title>
</head>
<body>
    <h1>Reserva de Quarto</h1>
    
    <!-- Formulário de reserva -->
    <form id="reservation-form" style="max-width: 400px; margin: auto;">

        <label for="checkin-date">Data de Check-In:</label>
        <input type="date" id="checkin-date" name="checkin-date" required><br><br>

        <label for="checkout-date">Data de Check-Out:</label>
        <input type="date" id="checkout-date" name="checkout-date" required><br><br>

        <label for="adults">Número de Adultos:</label>
        <input type="number" id="adults" name="adults" min="1" value="1" required><br><br>

        <label for="children">Número de Crianças:</label>
        <input type="number" id="children" name="children" min="0" value="0"><br><br>

        <!-- Botão de pagamento com Stripe -->
        <button type="button" id="checkout-button" style="width: 100%; padding: 10px; background-color: #28a745; color: white; font-size: 16px; cursor: pointer;">
            Pagar e Confirmar Reserva
        </button>
    </form>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
      const TEST_KEY = 'pk_test_51QL7dYH40HYEkt7KrSCog4qpidBop00Nj8wYTSk8HIlPvoSWonn5FebisZkqCYn8QjYvCoDAgqQIMzQdHF3huyqr00kYLsDV9B';
      const BASE_URL = `${window.location.protocol}//${window.location.host}`;
      const stripe = Stripe(TEST_KEY);

      // Função para capturar os dados do formulário e criar a sessão de checkout
      document.getElementById("checkout-button").addEventListener("click", async () => {
        const form = document.getElementById("reservation-form");
        const formData = new FormData(form);
        
        const reservationData = {
          checkinDate: formData.get("checkin-date"),
          checkoutDate: formData.get("checkout-date"),
          adults: formData.get("adults"),
          children: formData.get("children")
        };

        try {
          // Enviar os dados da reserva para o servidor
          const response = await fetch(`/create-checkout-session`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(reservationData), // Envia os dados do formulário para o backend
          });

          if (!response.ok) {
            throw new Error("Falha ao criar sessão de checkout");
          }

          const { sessionId } = await response.json();

          // Redireciona o usuário para o Stripe Checkout
          const result = await stripe.redirectToCheckout({
            sessionId: sessionId,
          });

          if (result.error) {
            console.error(result.error.message);
          }
        } catch (error) {
          console.error("Erro durante o redirecionamento:", error);
        }
      });
      // console.log("Response:", response);
      // const data = await response.json();
      // console.log("Session ID:", data.sessionId);
    </script>
</body>
</html>
